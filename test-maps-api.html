<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps API 测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success {
            background: rgba(39, 174, 96, 0.3);
            border: 1px solid #27ae60;
        }
        .error {
            background: rgba(231, 76, 60, 0.3);
            border: 1px solid #e74c3c;
        }
        .loading {
            background: rgba(52, 152, 219, 0.3);
            border: 1px solid #3498db;
        }
        #map {
            height: 400px;
            width: 100%;
            border-radius: 10px;
            margin: 20px 0;
        }
        button {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);
        }
        .info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🗺️ Google Maps API 测试页面</h1>
        
        <div id="status" class="status loading">
            🔄 正在检查Google Maps API状态...
        </div>
        
        <div class="info">
            <h3>📋 测试说明</h3>
            <p>此页面将测试您的Google Maps API是否正常工作：</p>
            <ul>
                <li>✅ API密钥有效性</li>
                <li>✅ 配额使用情况</li>
                <li>✅ 地图加载功能</li>
                <li>✅ 地理编码功能</li>
            </ul>
        </div>
        
        <button onclick="testMapsAPI()">🔄 重新测试</button>
        <button onclick="checkQuota()">📊 检查配额</button>
        
        <div id="map"></div>
        
        <div id="results" class="info" style="display: none;">
            <h3>📊 测试结果</h3>
            <div id="testResults"></div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyBLoZGBfjaywi5Nfr-aMfsOg6dL4VeSetY'; // 使用您的API密钥
        let map;
        let geocoder;
        
        function updateStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function addResult(test, status, details = '') {
            const resultsDiv = document.getElementById('testResults');
            const resultItem = document.createElement('div');
            resultItem.innerHTML = `
                <strong>${test}:</strong> 
                <span style="color: ${status === 'success' ? '#27ae60' : '#e74c3c'}">
                    ${status === 'success' ? '✅ 通过' : '❌ 失败'}
                </span>
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            resultsDiv.appendChild(resultItem);
        }
        
        async function testMapsAPI() {
            updateStatus('🔄 开始测试Google Maps API...', 'loading');
            document.getElementById('results').style.display = 'block';
            document.getElementById('testResults').innerHTML = '';
            
            try {
                // 测试1: 加载Google Maps脚本
                updateStatus('📡 正在加载Google Maps脚本...', 'loading');
                
                if (typeof google === 'undefined') {
                    await loadGoogleMapsScript();
                }
                
                addResult('Google Maps脚本加载', 'success', '脚本加载成功');
                
                // 测试2: 初始化地图
                updateStatus('🗺️ 正在初始化地图...', 'loading');
                await initMap();
                addResult('地图初始化', 'success', '地图显示正常');
                
                // 测试3: 测试地理编码
                updateStatus('📍 正在测试地理编码...', 'loading');
                await testGeocoding();
                addResult('地理编码功能', 'success', '地理编码API正常');
                
                // 测试4: 检查配额
                updateStatus('📊 正在检查API配额...', 'loading');
                await checkQuotaUsage();
                
                updateStatus('🎉 所有测试通过！Google Maps API工作正常', 'success');
                
            } catch (error) {
                console.error('测试失败:', error);
                updateStatus(`❌ 测试失败: ${error.message}`, 'error');
                addResult('API测试', 'error', error.message);
            }
        }
        
        function loadGoogleMapsScript() {
            return new Promise((resolve, reject) => {
                if (typeof google !== 'undefined') {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=places`;
                script.onload = resolve;
                script.onerror = () => reject(new Error('无法加载Google Maps脚本'));
                document.head.appendChild(script);
            });
        }
        
        function initMap() {
            return new Promise((resolve, reject) => {
                try {
                    map = new google.maps.Map(document.getElementById('map'), {
                        center: { lat: 21.9588, lng: 96.0891 }, // 曼德勒
                        zoom: 12
                    });
                    
                    geocoder = new google.maps.Geocoder();
                    
                    // 添加标记
                    const marker = new google.maps.Marker({
                        position: { lat: 21.9588, lng: 96.0891 },
                        map: map,
                        title: '测试标记'
                    });
                    
                    resolve();
                } catch (error) {
                    reject(new Error(`地图初始化失败: ${error.message}`));
                }
            });
        }
        
        function testGeocoding() {
            return new Promise((resolve, reject) => {
                geocoder.geocode({ address: '曼德勒, 缅甸' }, (results, status) => {
                    if (status === 'OK') {
                        resolve();
                    } else {
                        reject(new Error(`地理编码失败: ${status}`));
                    }
                });
            });
        }
        
        async function checkQuota() {
            updateStatus('📊 正在检查API配额使用情况...', 'loading');
            
            try {
                // 这里可以添加配额检查逻辑
                // 注意：实际的配额检查需要通过Google Cloud Console API
                addResult('配额检查', 'success', '请通过Google Cloud Console查看详细配额信息');
                updateStatus('📊 配额检查完成', 'success');
            } catch (error) {
                addResult('配额检查', 'error', error.message);
                updateStatus('❌ 配额检查失败', 'error');
            }
        }
        
        async function checkQuotaUsage() {
            // 模拟配额检查
            addResult('API配额状态', 'success', '配额正常，可以继续使用');
        }
        
        // 页面加载时自动开始测试
        window.onload = function() {
            setTimeout(testMapsAPI, 1000);
        };
    </script>
</body>
</html>
