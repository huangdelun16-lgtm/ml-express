# 📘 Spec-Kit 使用指南

欢迎使用 **规范驱动开发（Spec-Driven Development）**！

本指南将帮助你在 Market Link Express 项目中使用 spec-kit 来规范化新功能的开发。

---

## 🎯 什么是规范驱动开发？

规范驱动开发是一种**先写规范，再写代码**的开发方法：

1. **传统方式**：想到什么就写什么 → 容易遗漏需求、代码混乱
2. **规范驱动**：先明确需求和计划 → 代码清晰、质量高、易维护

---

## 📁 项目结构

```
ml-express/
├── .claude/
│   └── commands/          # Cursor/Claude 可用的命令
│       ├── specify.md     # 创建功能规范
│       └── plan.md        # 创建技术计划
├── memory/
│   └── constitution.md    # 项目开发原则（已创建）
├── specs/                 # 功能规范目录
│   ├── 001-xxx/          # 功能1的规范
│   └── 002-notification-system/  # 通知系统规范（示例）
│       ├── spec.md       # 功能规范
│       ├── plan.md       # 技术计划（待创建）
│       └── tasks.md      # 任务分解（待创建）
└── src/                  # 源代码
```

---

## 🚀 快速开始

### Step 1: 查看项目原则

打开 `memory/constitution.md`，了解项目的开发标准和规范。

### Step 2: 查看示例规范

打开 `specs/002-notification-system/spec.md`，看看一个完整的功能规范是什么样的。

### Step 3: 在 Cursor 中使用命令

在 Cursor 的聊天框中，你可以使用以下命令：

#### 📝 创建功能规范
```
/specify 我想添加一个短信通知功能，当包裹送达时自动发送短信给客户
```

#### 🔧 创建技术计划
```
/plan 使用现有的技术栈：React + TypeScript + Supabase，通过第三方SMS API发送短信
```

---

## 📖 详细使用步骤

### 1️⃣ 创建功能规范

当你想要添加新功能时：

**在 Cursor 中输入：**
```
/specify 我想添加一个数据导出功能，可以将包裹数据、财务数据导出为 Excel 文件
```

**AI 会帮你创建：**
- `specs/003-data-export/spec.md` 文件
- 包含用户故事、功能需求、验收标准等

**你需要做的：**
1. 审查规范是否完整
2. 补充遗漏的细节
3. 确认验收标准

---

### 2️⃣ 创建技术计划

有了规范后，制定技术方案：

**在 Cursor 中输入：**
```
/plan 使用 xlsx 库生成 Excel 文件，前端下载。添加导出按钮到财务管理和包裹管理页面
```

**AI 会帮你创建：**
- `specs/003-data-export/plan.md` 文件
- 包含架构设计、数据模型、实施步骤等

**你需要做的：**
1. 检查技术方案是否合理
2. 确认是否遵循 constitution.md 的原则
3. 评估开发时间和风险

---

### 3️⃣ 分解任务（手动或AI辅助）

**创建** `specs/003-data-export/tasks.md`：

```markdown
# 任务列表：数据导出功能

## 数据库准备
- [ ] 无需修改数据库

## 前端实现
- [ ] 安装 xlsx 库
- [ ] 在财务管理添加"导出Excel"按钮
- [ ] 实现导出函数
- [ ] 在包裹管理添加"导出Excel"按钮
- [ ] 测试导出功能

## 审计日志
- [ ] 记录导出操作到 audit_logs

## 测试
- [ ] 测试导出功能
- [ ] 测试大数据量导出
- [ ] 验证审计日志
```

---

### 4️⃣ 开始实施

按照任务列表，逐步实现功能：

1. **一次做一个任务**
2. **完成后勾选 checkbox**
3. **提交代码时引用规范**（如：`实现数据导出功能 (spec: 003-data-export)`）

---

## 💡 实用技巧

### 技巧1：先规范，后代码

❌ **错误做法**：
```
直接开始写代码 → 写到一半发现需求不清楚 → 重新修改
```

✅ **正确做法**：
```
/specify 描述需求 → 审查规范 → /plan 制定方案 → 开始编码
```

### 技巧2：利用 AI 辅助

你可以让 AI 帮你：
- 补充遗漏的用户场景
- 优化技术方案
- 生成测试用例
- 编写实现代码

**示例对话：**
```
我：这个通知功能的规范看起来不错，但我担心性能问题。能帮我补充性能优化的方案吗？

AI：当然！我会在 plan.md 中添加：
- 通知分页加载
- 使用虚拟滚动
- 缓存最近通知
- 数据库索引优化
```

### 技巧3：保持规范更新

功能开发过程中如果需求变更：
1. **先更新规范文档**
2. **然后修改代码**
3. **提交时说明变更原因**

### 技巧4：复用现有规范

遇到类似功能时，可以复制已有规范并修改：
```bash
cp -r specs/002-notification-system specs/004-email-alerts
# 然后修改 spec.md 和 plan.md
```

---

## 🎨 规范质量检查清单

一个好的规范应该：

### 功能规范 (spec.md)
- [ ] **明确的目标**：清楚说明要解决什么问题
- [ ] **完整的用户故事**：涵盖主要使用场景
- [ ] **详细的需求**：功能需求、界面需求、数据需求
- [ ] **可验证的标准**：验收标准清晰可测试
- [ ] **无技术细节**：专注"做什么"，不谈"怎么做"

### 技术计划 (plan.md)
- [ ] **遵循 constitution**：符合项目开发原则
- [ ] **完整的设计**：架构、数据模型、组件设计
- [ ] **审计日志**：所有CRUD操作记录日志
- [ ] **权限控制**：明确权限要求
- [ ] **清晰的步骤**：实施步骤具体可执行

---

## 📚 示例学习

### 示例1：通知系统
路径：`specs/002-notification-system/spec.md`

**学习要点**：
- 如何编写用户故事
- 如何定义功能需求
- 如何设置验收标准

### 示例2：员工监督（已实现）
虽然没有规范文档，但可以反向学习：
- 看代码如何实现审计日志
- 看权限如何控制
- 看组件如何设计

---

## 🔍 常见问题

### Q1: 我需要为所有功能都写规范吗？

**A**: 不一定。小改动（如修改按钮颜色）不需要。但以下情况**强烈建议**写规范：
- 新增页面或模块
- 修改核心业务逻辑
- 涉及多个组件的功能
- 需要团队协作的功能

### Q2: 规范太长，费时间怎么办？

**A**: 规范的详细程度取决于功能复杂度：
- **简单功能**：只需要核心需求 + 验收标准
- **中等功能**：添加用户故事
- **复杂功能**：完整的规范文档

**记住**：写规范的时间 < 改bug的时间！

### Q3: 规范和实际实现不一致怎么办？

**A**: 
1. **优先更新规范**：规范是真相的唯一来源
2. **记录变更原因**：在规范中注明为什么改变
3. **通知团队**：如果涉及其他人，要及时沟通

### Q4: 怎么知道规范写得好不好？

**A**: 测试方法：
- 把规范给别人看，问"你能根据这个实现吗？"
- 如果对方问题很多 → 规范不够清晰
- 如果对方能理解并开始实现 → 规范合格！

---

## 🎯 下一步

1. **阅读示例**：仔细阅读 `specs/002-notification-system/spec.md`
2. **练习使用**：为一个小功能写规范（如：添加搜索功能）
3. **实际应用**：下次开发新功能时使用 spec-kit
4. **持续改进**：根据实际使用完善流程

---

## 💬 获取帮助

在使用过程中遇到问题？

1. **参考 constitution.md**：查看项目开发原则
2. **查看示例规范**：学习已有的规范文档
3. **使用 AI 辅助**：在 Cursor 中直接问问题

---

**记住**：规范驱动开发的核心是**思考在前，编码在后**。一开始可能会觉得慢，但很快你会发现代码质量提升了，bug减少了，维护变容易了！

**祝你开发顺利！** 🚀
