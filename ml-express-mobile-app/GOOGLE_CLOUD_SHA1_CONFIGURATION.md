# 🔐 Google Cloud Console API Key SHA-1 指纹配置指南

## ❓ 问题

**Q: 可以在 Google Cloud Console 的 API Key 限制中添加 Google Play 期望的 SHA-1 指纹吗？**

**A: ✅ 可以！而且这是正确的做法！**

---

## ✅ 推荐配置：添加两个 SHA-1 指纹

### 为什么需要添加两个 SHA-1？

当使用 **Google Play App Signing** 时，有两个签名密钥：

1. **上传密钥（Upload Key）**: `8B:37:44:0A:07:3A:AA:EA:B1:F2:75:53:72:A3:BB:0D:3A:18:7D:E0`
   - 用于签名您上传到 Google Play 的 App Bundle
   - EAS Build 使用这个密钥签名

2. **应用签名密钥（App Signing Key）**: `8E:05:84:E7:07:02:08:17:E5:F8:FE:3B:8F:19:3C:5A:76:CD:FE:B8`
   - Google Play 使用这个密钥重新签名应用
   - **这是最终用户设备上安装的应用使用的签名**

### 关键点

- ✅ **在 Google Cloud Console 中，应该添加应用签名密钥的 SHA-1**（`8E:05:84:E7:07:02:08:17:E5:F8:FE:3B:8F:19:3C:5A:76:CD:FE:B8`）
- ✅ **因为这是最终用户设备上安装的应用使用的签名**
- ✅ **也可以同时添加两个 SHA-1，以确保兼容性**

---

## 📝 配置步骤

### 步骤 1：登录 Google Cloud Console

1. 访问：https://console.cloud.google.com
2. 使用您的账号登录
3. 选择您的项目

### 步骤 2：导航到 API 密钥管理

1. 左侧菜单 → **"API 和服务"** → **"凭据"**
2. 找到您的 Google Maps API 密钥
3. 点击密钥名称进入编辑页面

### 步骤 3：添加 SHA-1 指纹

1. 在 **"应用限制"** 部分，确认已选择 **"Android 应用"**
2. 点击 **"添加项目"** 或 **"添加 Android 应用"**

3. **添加第一个 SHA-1（应用签名密钥 - 推荐）**
   ```
   包名称: com.mlexpress.courier
   SHA-1 证书指纹: 8E:05:84:E7:07:02:08:17:E5:F8:FE:3B:8F:19:3C:5A:76:CD:FE:B8
   ```
   - 这是 Google Play 的应用签名密钥
   - **这是最终用户设备上安装的应用使用的签名**
   - ✅ **必须添加这个**

4. **添加第二个 SHA-1（上传密钥 - 可选但推荐）**
   ```
   包名称: com.mlexpress.courier
   SHA-1 证书指纹: 8B:37:44:0A:07:3A:AA:EA:B1:F2:75:53:72:A3:BB:0D:3A:18:7D:E0
   ```
   - 这是 EAS Build 使用的上传密钥
   - 添加这个可以确保在开发和测试阶段也能使用 API Key
   - ✅ **推荐添加这个**

5. **保存更改**
   - 点击 **"保存"**

---

## 🎯 配置建议

### 方案 1：只添加应用签名密钥（推荐用于生产环境）

**只添加**: `8E:05:84:E7:07:02:08:17:E5:F8:FE:3B:8F:19:3C:5A:76:CD:FE:B8`

**优点**:
- ✅ 只允许正式发布的应用使用 API Key
- ✅ 更安全，防止开发版本滥用 API Key

**缺点**:
- ⚠️ 开发版本（使用上传密钥签名）无法使用 Google Maps API
- ⚠️ 需要在开发时使用不同的 API Key

### 方案 2：同时添加两个 SHA-1（推荐用于开发和生产）

**添加两个**:
1. `8E:05:84:E7:07:02:08:17:E5:F8:FE:3B:8F:19:3C:5A:76:CD:FE:B8`（应用签名密钥）
2. `8B:37:44:0A:07:3A:AA:EA:B1:F2:75:53:72:A3:BB:0D:3A:18:7D:E0`（上传密钥）

**优点**:
- ✅ 开发版本和生产版本都可以使用 API Key
- ✅ 更方便开发和测试
- ✅ 不需要切换 API Key

**缺点**:
- ⚠️ 开发版本也可以使用 API Key（如果担心配额，可以设置配额限制）

---

## 📋 配置检查清单

完成配置后，请确认：

- [ ] ✅ 已登录 Google Cloud Console
- [ ] ✅ 已找到 Google Maps API 密钥
- [ ] ✅ 已添加包名：`com.mlexpress.courier`
- [ ] ✅ 已添加应用签名密钥 SHA-1：`8E:05:84:E7:07:02:08:17:E5:F8:FE:3B:8F:19:3C:5A:76:CD:FE:B8`
- [ ] ✅ （可选）已添加上传密钥 SHA-1：`8B:37:44:0A:07:3A:AA:EA:B1:F2:75:53:72:A3:BB:0D:3A:18:7D:E0`
- [ ] ✅ 已保存更改

---

## 🔍 验证配置

### 方法 1：在应用中测试

1. 重新构建应用
   ```bash
   cd ml-express-mobile-app
   eas build --platform android --profile production
   ```

2. 安装并测试应用
   - 打开地图功能
   - 如果地图正常显示，说明 API Key 配置正确

### 方法 2：检查 Google Cloud Console 使用情况

1. 登录 Google Cloud Console
2. 导航到 **"API 和服务"** → **"仪表板"**
3. 查看 Google Maps API 的使用情况
4. 如果看到使用记录，说明配置正确

---

## ⚠️ 重要提示

### 1. 应用签名密钥 vs 上传密钥

- **应用签名密钥** (`8E:05:84:E7:07:02:08:17:E5:F8:FE:3B:8F:19:3C:5A:76:CD:FE:B8`): 
  - ✅ 这是最终用户设备上安装的应用使用的签名
  - ✅ **必须添加这个**

- **上传密钥** (`8B:37:44:0A:07:3A:AA:EA:B1:F2:75:53:72:A3:BB:0D:3A:18:7D:E0`):
  - 用于签名上传到 Google Play 的 App Bundle
  - 可选添加（如果需要在开发版本中使用 API Key）

### 2. Google Play App Signing

如果启用了 Google Play App Signing：
- Google Play 会自动管理应用签名密钥
- 您只需要确保在 Google Cloud Console 中添加了正确的 SHA-1

### 3. 配额管理

- ⚠️ 如果同时添加两个 SHA-1，开发版本也会消耗 API 配额
- ✅ 建议设置配额限制和预算警报

---

## ✅ 总结

**答案**: ✅ **可以添加 Google Play 期望的 SHA-1 指纹！**

**推荐配置**:
1. ✅ **必须添加**: `8E:05:84:E7:07:02:08:17:E5:F8:FE:3B:8F:19:3C:5A:76:CD:FE:B8`（应用签名密钥）
2. ✅ **推荐添加**: `8B:37:44:0A:07:3A:AA:EA:B1:F2:75:53:72:A3:BB:0D:3A:18:7D:E0`（上传密钥）

**原因**:
- 应用签名密钥是最终用户设备上安装的应用使用的签名
- 上传密钥可以用于开发和测试

---

**文档创建时间**: 2025-01-16

