# 🔧 构建错误解决方案

## ⚠️ 当前错误

**错误信息**: `Gradle build failed with unknown error`

**构建日志**: https://expo.dev/accounts/amt349/projects/MarketLinkStaffApp/builds/356abb51-3f0d-4d74-96ba-37c7e77c19a7

---

## 🔍 第一步：查看详细错误日志

1. **打开构建日志链接**：
   - 点击上面的链接，或复制到浏览器打开
   - 查看 "Run gradlew" 阶段的错误信息

2. **常见错误类型**：
   - 依赖冲突
   - 配置错误
   - 资源文件缺失
   - 权限配置问题

---

## 🔧 常见解决方案

### 方案 1：修复 versionCode 警告

**问题**：`app.config.js` 中的 `versionCode` 会被忽略（因为使用 remote version source）

**已修复**：已从 `app.config.js` 中移除 `versionCode`，由 EAS 自动管理

---

### 方案 2：检查依赖版本兼容性

**可能问题**：某些依赖版本不兼容

**解决方法**：

1. **检查 Expo SDK 版本**：
   - 当前使用：`expo: "54.0.13"`
   - 确保所有 expo 包版本兼容

2. **更新依赖**（如果需要）：

```bash
cd ml-express-mobile-app
npx expo install --fix
```

这会自动修复依赖版本不兼容问题。

---

### 方案 3：清理并重新构建

**步骤**：

1. **清理缓存**：

```bash
cd ml-express-mobile-app
rm -rf node_modules
rm -rf .expo
npm cache clean --force
```

2. **重新安装依赖**：

```bash
npm install
```

3. **重新构建**：

```bash
eas build --platform android --profile production --clear-cache
```

`--clear-cache` 参数会清理 EAS 构建缓存。

---

### 方案 4：检查资源文件

**可能问题**：图标或启动画面文件缺失或格式错误

**检查**：

1. **确认文件存在**：
   - `./assets/icon.png` (512x512 像素)
   - `./assets/adaptive-icon.png` (1024x1024 像素)
   - `./assets/splash-icon.png`

2. **检查文件格式**：
   - 图标必须是 PNG 格式
   - 尺寸必须正确

---

### 方案 5：检查插件配置

**可能问题**：expo-camera、expo-location 等插件配置错误

**解决方法**：

1. **确保插件已正确安装**：

```bash
npx expo install expo-camera expo-location expo-media-library
```

2. **检查 app.config.js 中的插件配置**：
   - 确保插件名称正确
   - 确保配置格式正确

---

### 方案 6：使用本地构建（调试）

如果云端构建一直失败，可以尝试本地构建来查看更详细的错误：

```bash
eas build --platform android --profile production --local
```

**注意**：本地构建需要：
- Android SDK 已安装
- Java JDK 已安装
- 可能需要较长时间

---

## 📋 推荐操作步骤

### 步骤 1：查看构建日志

1. 打开链接：https://expo.dev/accounts/amt349/projects/MarketLinkStaffApp/builds/356abb51-3f0d-4d74-96ba-37c7e77c19a7
2. 找到 "Run gradlew" 阶段
3. 查看具体的错误信息
4. 复制错误信息告诉我

### 步骤 2：修复 versionCode（已完成）

✅ 已从 `app.config.js` 中移除 `versionCode`

### 步骤 3：清理并重新构建

运行以下命令：

```bash
cd /Users/aungmyatthu/Desktop/ml-express/ml-express-mobile-app

# 清理
rm -rf node_modules .expo
npm cache clean --force

# 重新安装
npm install

# 修复依赖版本
npx expo install --fix

# 重新构建（清理缓存）
eas build --platform android --profile production --clear-cache
```

---

## 🆘 如果还是失败

请告诉我：

1. **构建日志中的具体错误信息**（从链接中复制）
2. **错误发生在哪个阶段**（Run gradlew、Install dependencies 等）
3. **完整的错误堆栈**（如果有）

我会根据具体错误提供针对性的解决方案。

---

## 📝 常见错误示例

### 错误 1：依赖版本冲突

**错误信息**：
```
Conflict between dependency versions
```

**解决方法**：
```bash
npx expo install --fix
```

### 错误 2：资源文件缺失

**错误信息**：
```
Resource not found: icon.png
```

**解决方法**：
- 检查 `assets` 文件夹中的文件是否存在
- 确保文件路径正确

### 错误 3：权限配置错误

**错误信息**：
```
Permission denied
```

**解决方法**：
- 检查 `app.config.js` 中的权限配置
- 确保权限名称正确

---

**请先查看构建日志，告诉我具体的错误信息，我会帮您解决！** 🔧

