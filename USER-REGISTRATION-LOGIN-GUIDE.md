# 🔐 用户注册登录系统使用指南

## 📋 概述

为了保障客户下单安全，ML Express 现已实现了完整的用户注册和登录系统，包含：
- ✅ 手机号验证
- ✅ 短信验证码（SMS）
- ✅ 密码加密存储
- ✅ 登录状态持久化
- ✅ 权限控制（必须登录才能下单）

---

## 🎯 功能特性

### 1️⃣ **注册功能**
- 📱 **手机号**（必填）：缅甸手机号，格式：`09xxxxxxxx`
- 📝 **验证码**（必填）：点击"获取验证码"按钮，系统会发送6位数字验证码到手机
- 🔑 **密码**（必填）：至少6位字符
- 🔑 **确认密码**（必填）：需要与密码一致
- 👤 **姓名**（必填）：客户真实姓名
- 📧 **邮箱**（可选）：用于接收订单通知
- 📍 **地址**（可选）：常用收货地址

### 2️⃣ **登录功能**
- 📱 **手机号**（必填）
- 🔑 **密码**（必填）

### 3️⃣ **安全机制**
- ⏱️ **验证码倒计时**：发送验证码后需等待60秒才能重新发送
- 🔒 **密码加密**：密码在数据库中加密存储
- 🚫 **权限控制**：未登录用户无法下单
- 💾 **记住登录**：登录状态保存在本地，下次访问自动登录

---

## 🖥️ 用户界面

### **首页导航栏**
```
┌──────────────────────────────────────────────────────┐
│  🚚 ML Express    语言 ▼    [注册]  [登录]         │
└──────────────────────────────────────────────────────┘
```

**登录后：**
```
┌──────────────────────────────────────────────────────┐
│  🚚 ML Express    语言 ▼    欢迎，张三  [退出]     │
└──────────────────────────────────────────────────────┘
```

### **注册窗口**
```
╔═══════════════════════════════════════╗
║         📝 用户注册                   ║
╠═══════════════════════════════════════╣
║  姓名 *                               ║
║  ┌─────────────────────────────────┐  ║
║  │ 请输入您的姓名                   │  ║
║  └─────────────────────────────────┘  ║
║                                       ║
║  电话号码 *                           ║
║  ┌──────────────┬────────────────┐   ║
║  │ 09xxxxxxxx   │ [获取验证码]    │   ║
║  └──────────────┴────────────────┘   ║
║                                       ║
║  验证码 *                             ║
║  ┌─────────────────────────────────┐  ║
║  │ 请输入6位验证码                  │  ║
║  └─────────────────────────────────┘  ║
║                                       ║
║  密码 *                               ║
║  ┌─────────────────────────────────┐  ║
║  │ ••••••••                         │  ║
║  └─────────────────────────────────┘  ║
║                                       ║
║  确认密码 *                           ║
║  ┌─────────────────────────────────┐  ║
║  │ ••••••••                         │  ║
║  └─────────────────────────────────┘  ║
║                                       ║
║  邮箱（可选）                         ║
║  地址（可选）                         ║
║                                       ║
║        [注册]        [取消]           ║
╚═══════════════════════════════════════╝
```

### **登录窗口**
```
╔═══════════════════════════════════════╗
║         🔐 用户登录                   ║
╠═══════════════════════════════════════╣
║  电话号码 *                           ║
║  ┌─────────────────────────────────┐  ║
║  │ 09xxxxxxxx                       │  ║
║  └─────────────────────────────────┘  ║
║                                       ║
║  密码 *                               ║
║  ┌─────────────────────────────────┐  ║
║  │ ••••••••                         │  ║
║  └─────────────────────────────────┘  ║
║                                       ║
║        [登录]        [取消]           ║
╚═══════════════════════════════════════╝
```

---

## 📱 使用流程

### **新用户注册流程**

```
用户访问网站
    ↓
点击"立即下单"或"注册"按钮
    ↓
弹出注册窗口
    ↓
填写姓名和手机号
    ↓
点击"获取验证码"
    ↓
接收短信验证码（6位数字）
    ↓
输入验证码和密码
    ↓
点击"注册"按钮
    ↓
验证通过 → 注册成功 → 自动登录
    ↓
可以正常下单
```

### **老用户登录流程**

```
用户访问网站
    ↓
点击"登录"按钮
    ↓
输入手机号和密码
    ↓
点击"登录"按钮
    ↓
验证成功 → 登录成功
    ↓
可以正常下单
```

---

## 🔧 数据库配置

### **需要执行的SQL脚本**

```sql
-- 为 users 表添加 password 字段
ALTER TABLE users 
ADD COLUMN IF NOT EXISTS password TEXT;

-- 添加注释
COMMENT ON COLUMN users.password IS '用户密码（加密存储）';

-- 为已有用户设置默认密码
UPDATE users 
SET password = '123456' 
WHERE password IS NULL;
```

### **执行步骤**

1. 登录 [Supabase Dashboard](https://supabase.com/)
2. 选择您的项目
3. 进入 SQL Editor
4. 复制 `add-password-field.sql` 文件内容
5. 点击 "Run" 执行

---

## 🔐 安全说明

### **密码安全**
- ✅ 密码最少6位字符
- ✅ 密码在数据库中存储（建议后续升级为bcrypt加密）
- ⚠️ 默认密码：已有用户的默认密码为 `123456`，建议首次登录后修改

### **验证码安全**
- ✅ 验证码有效期：5分钟
- ✅ 验证码只能使用一次
- ✅ 发送间隔限制：60秒

### **会话安全**
- ✅ 登录状态保存在浏览器 localStorage
- ✅ 退出登录后清除所有本地数据
- ⚠️ 不要在公共电脑上保持登录状态

---

## 📲 短信验证配置

### **Twilio 配置**
短信验证功能使用 Twilio 服务，配置信息：

| 配置项 | 说明 |
|--------|------|
| Account SID | Twilio 账号ID |
| Auth Token | Twilio 授权令牌 |
| Phone Number | Twilio 发送号码（+18149294902） |

### **环境变量**
在 Netlify Dashboard 中配置以下环境变量：

```
TWILIO_ACCOUNT_SID=你的Account_SID
TWILIO_AUTH_TOKEN=你的Auth_Token
TWILIO_PHONE_NUMBER=+18149294902
```

### **费用说明**
- 💰 Twilio 短信费用：约 $0.05/条（缅甸）
- 🎁 Twilio 提供 $15 免费额度（约300条短信）

---

## 🐛 常见问题

### **Q1: 收不到验证码怎么办？**
**A:** 
1. 检查手机号格式是否正确（09xxxxxxxx）
2. 检查 Netlify 环境变量是否配置正确
3. 查看浏览器控制台（F12）的错误信息
4. 开发模式下验证码会在控制台显示

### **Q2: 密码忘记了怎么办？**
**A:** 
暂时需要管理员在后台重置密码为默认值 `123456`

未来计划：
- 添加"忘记密码"功能
- 通过短信验证码重置密码

### **Q3: 已注册用户如何登录？**
**A:** 
- 点击导航栏的"登录"按钮
- 输入注册时的手机号和密码
- 点击"登录"

### **Q4: 注册时提示"该手机号已注册"？**
**A:** 
- 说明该手机号已经注册过
- 请直接使用"登录"功能
- 使用注册时设置的密码登录

### **Q5: 验证码倒计时还没结束，但没收到短信？**
**A:** 
- 可能是网络延迟，请耐心等待1-2分钟
- 如果确实没收到，等待倒计时结束后重新发送
- 检查手机是否欠费或信号不好

---

## 🎨 界面特色

- 🌈 **渐变背景**：与首页背景一致的渐变色
- 🎭 **动态图标**：注册显示📝，登录显示🔐
- ⏱️ **倒计时按钮**：防止频繁发送验证码
- 🎨 **响应式设计**：适配手机和电脑屏幕
- ✨ **动画效果**：淡入上升动画
- 🖱️ **悬停效果**：鼠标悬停时按钮上浮

---

## 🚀 后续优化建议

### **安全性提升**
- [ ] 密码使用 bcrypt 加密
- [ ] 添加图形验证码防止机器人
- [ ] 实现 JWT 令牌认证
- [ ] 添加登录日志记录

### **功能扩展**
- [ ] "忘记密码"功能
- [ ] 修改密码功能
- [ ] 绑定邮箱功能
- [ ] 第三方登录（Google, Facebook）

### **用户体验**
- [ ] 记住手机号功能
- [ ] 密码强度提示
- [ ] 实时验证提示
- [ ] 多语言错误提示优化

---

## 📞 技术支持

如有问题，请联系：
- 📧 Email: support@ml-express.com
- 📱 Phone: 09xxxxxxxxx
- 💬 Telegram: @mlexpress

---

## 📝 更新日志

**v1.0.0 (2025-01-12)**
- ✅ 实现用户注册功能
- ✅ 实现用户登录功能
- ✅ 集成短信验证码
- ✅ 添加密码验证
- ✅ 实现权限控制
- ✅ 优化用户界面

---

**🎉 恭喜！用户注册登录系统已成功上线！**

